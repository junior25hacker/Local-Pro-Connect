{% extends "base.html" %}
{% load static %}

{% block title %}Provider Dashboard - My Requests{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-12">
            <h1>Provider Dashboard</h1>
            <hr>
            
            <!-- Provider Info -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Your Business Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Company Name:</strong> {{ provider_profile.company_name }}</p>
                            <p><strong>Service Type:</strong> {{ provider_profile.get_service_type_display }}</p>
                            <p><strong>Location:</strong> {{ provider_profile.city }}, {{ provider_profile.state }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Phone:</strong> {{ provider_profile.phone }}</p>
                            <p><strong>Experience:</strong> {{ provider_profile.years_experience }} years</p>
                            <p><strong>Rating:</strong> ‚≠ê {{ provider_profile.rating }}/5.0 ({{ provider_profile.total_reviews }} reviews)</p>
                        </div>
                    </div>
                    <a href="{% url 'accounts:edit_provider_profile' provider_profile.id %}" class="btn btn-sm btn-primary">
                        Edit Profile
                    </a>
                </div>
            </div>
            
            <!-- Statistics -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-primary">{{ pending_count }}</h3>
                            <p class="text-muted">Pending Requests</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-success">{{ accepted_count }}</h3>
                            <p class="text-muted">Accepted Requests</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-danger">{{ declined_count }}</h3>
                            <p class="text-muted">Declined Requests</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pending Requests -->
            {% if pending_requests %}
            <div class="card mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">Pending Requests ({{ pending_count }})</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Request ID</th>
                                    <th>Client Name</th>
                                    <th>Description</th>
                                    <th>Submitted Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for request in pending_requests %}
                                <tr>
                                    <td>#{{ request.id }}</td>
                                    <td>{{ request.user.first_name|default:request.user.username }}</td>
                                    <td>{{ request.description|truncatewords:15 }}</td>
                                    <td>{{ request.created_at|date:"M d, Y g:i A" }}</td>
                                    <td>
                                        <a href="{% url 'requests:request_detail' request.id %}" class="btn btn-sm btn-info">View</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="alert alert-info">
                <strong>No pending requests</strong> - You're all caught up!
            </div>
            {% endif %}
            
            <!-- Accepted Requests -->
            {% if accepted_requests %}
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Accepted Requests ({{ accepted_count }})</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Request ID</th>
                                    <th>Client Name</th>
                                    <th>Description</th>
                                    <th>Accepted Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for request in accepted_requests %}
                                <tr>
                                    <td>#{{ request.id }}</td>
                                    <td>{{ request.user.first_name|default:request.user.username }}</td>
                                    <td>{{ request.description|truncatewords:15 }}</td>
                                    <td>{{ request.accepted_at|date:"M d, Y g:i A" }}</td>
                                    <td>
                                        <a href="{% url 'requests:request_detail' request.id %}" class="btn btn-sm btn-info">View</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Declined Requests -->
            {% if declined_requests %}
            <div class="card mb-4">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">Declined Requests ({{ declined_count }})</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Request ID</th>
                                    <th>Client Name</th>
                                    <th>Description</th>
                                    <th>Declined Date</th>
                                    <th>Reason</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for request in declined_requests %}
                                <tr>
                                    <td>#{{ request.id }}</td>
                                    <td>{{ request.user.first_name|default:request.user.username }}</td>
                                    <td>{{ request.description|truncatewords:15 }}</td>
                                    <td>{{ request.declined_at|date:"M d, Y g:i A" }}</td>
                                    <td>{{ request.get_decline_reason_display }}</td>
                                    <td>
                                        <a href="{% url 'requests:request_detail' request.id %}" class="btn btn-sm btn-info">View</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- No Requests -->
            {% if not all_requests %}
            <div class="alert alert-info">
                <strong>No requests yet</strong> - Your profile is live! Wait for clients to send you requests.
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .card {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .table-hover tbody tr:hover {
        background-color: #f5f5f5;
    }
    
    .text-primary {
        color: #007bff !important;
    }
    
    .text-success {
        color: #28a745 !important;
    }
    
    .text-danger {
        color: #dc3545 !important;
    }
</style>
{% endblock %}
